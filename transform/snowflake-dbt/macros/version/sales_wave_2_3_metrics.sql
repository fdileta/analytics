{% macro sales_wave_2_3_metrics() %} 

    -- usage ping data - devops metrics
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['manage']['events']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['manage']['events']::NUMBER)                                                                    AS umau_28_days_user,                                            
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['create']['action_monthly_active_users_project_repo']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['create']['action_monthly_active_users_project_repo']::NUMBER) AS action_monthly_active_users_project_repo_28_days_user,       
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['create']['merge_requests']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['create']['merge_requests']::NUMBER)                                                    AS merge_requests_28_days_user,                                  
    UPPER(TRY_TO_BOOLEAN(raw_usage_data_payload['usage_activity_by_stage_monthly']['create']['projects_with_repositories_enabled']::VARCHAR))                                                                                                                      AS projects_with_repositories_enabled_28_days_user,              
    IFF(raw_usage_data_payload['counts']['commit_comment']::NUMBER  < 0, NULL, raw_usage_data_payload['counts']['commit_comment']::NUMBER)                                                                                                                         AS commit_comment_all_time,                                      
    IFF(raw_usage_data_payload['counts']['source_code_pushes']::NUMBER  < 0, NULL, raw_usage_data_payload['counts']['source_code_pushes']::NUMBER)                                                                                                                 AS source_code_pushes_all_time,                                  
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['verify']['ci_pipelines']::NUMBER  < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['verify']['ci_pipelines']::NUMBER)                                                       AS ci_pipelines_28_days_user,                                    
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['verify']['ci_internal_pipelines']::NUMBER  < 0, NULL,  raw_usage_data_payload['usage_activity_by_stage_monthly']['verify']['ci_internal_pipelines']::NUMBER)                                    AS ci_internal_pipelines_28_days_user,                           
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['create']['ci_builds']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['create']['ci_builds']::NUMBER)                                                              AS ci_builds_28_days_user_28_days_user,                          
    IFF(raw_usage_data_payload['usage_activity_by_stage']['create']['ci_builds']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage']['create']['ci_builds']::NUMBER)                                                                              AS ci_builds_all_time_user,                            
    IFF(raw_usage_data_payload['counts']['ci_builds']::NUMBER < 0, NULL, raw_usage_data_payload['counts']['ci_builds']::NUMBER)                                                                                                                                    AS ci_builds_all_time_event,                   
    IFF(raw_usage_data_payload['counts']['ci_runners']::NUMBER < 0, NULL,raw_usage_data_payload['counts']['ci_runners']::NUMBER)                                                                                                                                   AS ci_runners_all_time_event,                                
    UPPER(TRY_TO_BOOLEAN(raw_usage_data_payload['counts']['auto_devops_enabled']::VARCHAR))                                                                                                                                                                        AS auto_devops_enable_all_time_event,                          
    UPPER(TRY_TO_BOOLEAN(raw_usage_data_payload['gitlab_shared_runners_enabled']::VARCHAR))                                                                                                                                                                        AS gitlab_shared_runners_enabled_instance_setting,            
    UPPER(TRY_TO_BOOLEAN(raw_usage_data_payload['container_registry_enabled']::VARCHAR))                                                                                                                                                                           AS container_registry_enabled_instance_setting,   
    IFF(raw_usage_data_payload['counts']['template_repositories']::NUMBER < 0, NULL, raw_usage_data_payload['counts']['template_repositories']::NUMBER)                                                                                                            AS template_repositories_all_time_event,                     
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['create']['ci_pipeline_config_repository']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['create']['ci_pipeline_config_repository']::NUMBER)                      AS ci_pipeline_config_repository_28_days_user,             
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_unique_users_all_secure_scanners']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_unique_users_all_secure_scanners']::NUMBER)      AS user_unique_users_all_secure_scanners_28_days_user,     
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_sast_jobs']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_sast_jobs']::NUMBER)                                                    AS user_sast_jobs_28_days_user,                            
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_dast_jobs']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_dast_jobs']::NUMBER)                                                    AS user_dast_jobs_28_days_user,                              
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_dependency_scanning_jobs']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_dependency_scanning_jobs']::NUMBER)                      AS user_dependency_scanning_jobs_28_days_user,             
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_license_management_jobs']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_license_management_jobs']::NUMBER)                        AS user_license_management_jobs_28_days_user,                   
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_secret_detection_jobs']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_secret_detection_jobs']::NUMBER)                            AS user_secret_detection_jobs_28_days_user,          
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_container_scanning_jobs']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['secure']['user_container_scanning_jobs']::NUMBER)                        AS user_container_scanning_job_28_days_users,            
    UPPER(TRY_TO_BOOLEAN(raw_usage_data_payload['object_store']['packages']['enabled']::VARCHAR))                                                                                                                                                                  AS object_store_packages_enabled_instance_setting,       
    IFF(raw_usage_data_payload['counts']['projects_with_packages']::NUMBER < 0, NULL, raw_usage_data_payload['counts']['projects_with_packages']::NUMBER)                                                                                                          AS projects_with_packages_all_time_event,                  
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['package']['projects_with_packages']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['package']['projects_with_packages']::NUMBER)                                  AS projects_with_packages_28_days_users,          
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['release']['deployments']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['release']['deployments']::NUMBER)                                                        AS deployments_28_days_users,                  
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['release']['releases']::NUMBER  < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['release']['releases']::NUMBER)                                                             AS releases_28_days_users,                              
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['plan']['epics']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['plan']['epics']::NUMBER)                                                                          AS epics_28_days_users,                  
    IFF(raw_usage_data_payload['usage_activity_by_stage_monthly']['plan']['issues']::NUMBER < 0, NULL, raw_usage_data_payload['usage_activity_by_stage_monthly']['plan']['issues']::NUMBER)                                                                        AS issues_28_days_users          

{%- endmacro -%}
